
// JoyShtick.html 
// Matthew Olsson 10/10/2014
// JoyShtick.js Library 
// http://joyshtickblog.blogspot.com/

<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, 
    user-scalable=no, initial-scale=1, maximum-scale=1, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<style type="text/css">
	body { margin: 0; padding: 0; background: #000;}
</style>
<script src="JoyShtick.js"></script>
<script>

	window.onload = init;

	window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       || 
        window.webkitRequestAnimationFrame || 
        window.mozRequestAnimationFrame    || 
        window.oRequestAnimationFrame      || 
        window.msRequestAnimationFrame     || 
        function(/* function */ callback, /* DOMElement */ element){
            window.setTimeout(callback, 1000 / 60);
        };
	})();

	var playerX, playerY,ctx,joystick,goalX,goalY,appWidth,appHeight;
	var PLAYER_WIDTH = 30, PLAYER_SPEED = 5, GOAL_WIDTH = 30;

	function init(){
		var host = document.getElementById("main");
		ctx = host.getContext("2d");
		var result = viewport();
		host.height = result.height;
		host.width = result.width;
		appWidth = host.width;
		appHeight = host.height;

		joystick = new JoyShtick(host.width,host.height);
		var hello = function(){ host.style.background = "yellow"; }
		var goodbye = function(){ host.style.background = "purple"; }

		// x,y,function,color(rgba),shape,width
		joystick.addButton("85%","60%",goodbye,"rgba(0,0,255,.5)","square","6%");
		joystick.addButton("80%","80%",hello,"rgba(255,0,0,.5)","circle","6%");

		playerX = host.width/2;
		playerY = host.height/2;
		goalX = Math.floor(Math.random() * (appWidth-1)) + 1;
		goalY = Math.floor(Math.random() * (appHeight-1)) + 1;
		animate();
	}

	function updatePlayer(stickVector){
		if(stickVector.horizontal != undefined && stickVector.vertical != undefined){
			playerX += (stickVector.horizontal/100)*PLAYER_SPEED;
			playerY += (stickVector.vertical/100)*PLAYER_SPEED;
		}
		
		// checks for collision between player and goal
		if(playerX <= goalX + GOAL_WIDTH && goalX <= playerX + PLAYER_WIDTH && playerY <= goalY + GOAL_WIDTH && goalY <= playerY + PLAYER_WIDTH){
			goalX = Math.floor(Math.random() * (appWidth-1)) + 1;
			goalY = Math.floor(Math.random() * (appHeight-1)) + 1; 
		}
	}

	function animate() {
	    requestAnimFrame( animate );
	    // move player
	    updatePlayer(joystick.stickVector);
	    // draw player
	    draw();
	}

	function draw() {
		ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.width);
	    ctx.fillStyle = "red";
	    ctx.fillRect(playerX,playerY,PLAYER_WIDTH,PLAYER_WIDTH);
	    ctx.fill();
	    ctx.fillStyle = "green";
	    ctx.fillRect(goalX,goalY,GOAL_WIDTH,GOAL_WIDTH);
	    ctx.fill();
	}

	function viewport() {
		var e = window
		, a = 'inner';
		if ( !( 'innerWidth' in window ) )
		{
			a = 'client';
			e = document.documentElement || document.body;
		}
		return { width : e[ a+'Width' ] , height : e[ a+'Height' ] }
	}
</script>
</head>
<body>
	<canvas id="main" style="position: absolute; left: 0; top: 0; background: #ffffff;"></canvas>
</body>
</html>